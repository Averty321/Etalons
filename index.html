<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–≠–≤–æ–ª—é—Ü–∏—è: –ü—É—Ç—å –æ—Ç –û–±–µ–∑—å—è–Ω—ã –∫ –ß–µ–ª–æ–≤–µ–∫—É</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3;
            transition: opacity 0.5s;
        }
        
        .hidden {
            display: none !important;
        }
        
        h1 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        button {
            background: linear-gradient(to bottom, #ff7e5f, #feb47b);
            border: none;
            border-radius: 50px;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            margin: 10px;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #stats {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            pointer-events: none;
            z-index: 4;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 0 20px;
            pointer-events: none;
            z-index: 4;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            pointer-events: auto;
        }
        
        #joystick-area {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            pointer-events: auto;
            z-index: 4;
        }
        
        #joystick {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            touch-action: none;
        }
        
        #evolution-bar-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            z-index: 4;
            pointer-events: none;
        }
        
        #evolution-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        #stage-indicator {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 4;
            pointer-events: none;
        }
        
        .creature {
            position: absolute;
            transition: transform 0.2s;
        }
        
        .food {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #8bc34a;
            border-radius: 50%;
        }
        
        .evolution-notification {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            animation: fadeOut 3s forwards;
            z-index: 5;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="ui-overlay">
            <div id="stats">
                <div>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy-value">100</span></div>
                <div>–°–æ–±—Ä–∞–Ω–æ –µ–¥—ã: <span id="food-count">0</span></div>
            </div>
            
            <div id="evolution-bar-container">
                <div id="evolution-bar"></div>
            </div>
            <div id="stage-indicator">–û–±–µ–∑—å—è–Ω–∞</div>
            
            <div id="controls">
                <div class="control-btn" id="action-btn">‚ö°</div>
                <div class="control-btn" id="special-btn">üåü</div>
            </div>
            
            <div id="joystick-area">
                <div id="joystick"></div>
            </div>
        </div>
        
        <div id="start-screen" class="screen">
            <h1>–≠–≤–æ–ª—é—Ü–∏—è: –ü—É—Ç—å –æ—Ç –û–±–µ–∑—å—è–Ω—ã –∫ –ß–µ–ª–æ–≤–µ–∫—É</h1>
            <p>–°–æ–±–∏—Ä–∞–π—Ç–µ –µ–¥—É, –∏–∑–±–µ–≥–∞–π—Ç–µ —Ö–∏—â–Ω–∏–∫–æ–≤ –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Ç–µ—Å—å!</p>
            <button id="start-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <div id="evolution-screen" class="screen hidden">
            <h1>–ù–æ–≤–∞—è —Å—Ç–∞–¥–∏—è —ç–≤–æ–ª—é—Ü–∏–∏!</h1>
            <div id="evolution-stage"></div>
            <button id="continue-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
        
        <div id="game-over-screen" class="screen hidden">
            <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h1>
            <p>–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏: <span id="final-stage">–û–±–µ–∑—å—è–Ω–∞</span></p>
            <button id="restart-button">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let canvas, ctx;
        let gameActive = false;
        let player = {
            x: 0,
            y: 0,
            speed: 3,
            size: 30,
            energy: 100,
            foodCollected: 0,
            evolutionProgress: 0,
            stage: 0,
            stageNames: ['–û–±–µ–∑—å—è–Ω–∞', '–ì–æ–º–∏–Ω–∏–¥', '–ß–µ–ª–æ–≤–µ–∫ —É–º–µ–ª—ã–π', '–ß–µ–ª–æ–≤–µ–∫ –ø—Ä—è–º–æ—Ö–æ–¥—è—â–∏–π', '–ß–µ–ª–æ–≤–µ–∫ —Ä–∞–∑—É–º–Ω—ã–π'],
            color: '#8b4513'
        };
        
        let creatures = [];
        let foods = [];
        let joystick = { x: 0, y: 0, active: false };
        let touchId = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            
            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            window.addEventListener('resize', resizeCanvas);
            document.getElementById('start-button').addEventListener('click', startGame);
            document.getElementById('restart-button').addEventListener('click', startGame);
            document.getElementById('continue-button').addEventListener('click', continueGame);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            const joystickArea = document.getElementById('joystick-area');
            const joystickElement = document.getElementById('joystick');
            
            joystickArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                
                const touch = e.touches[0];
                touchId = touch.identifier;
                joystick.active = true;
                updateJoystickPosition(touch.clientX, touch.clientY);
            });
            
            joystickArea.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!gameActive || !joystick.active) return;
                
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === touchId) {
                        updateJoystickPosition(e.changedTouches[i].clientX, e.changedTouches[i].clientY);
                        break;
                    }
                }
            });
            
            joystickArea.addEventListener('touchend', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === touchId) {
                        resetJoystick();
                        break;
                    }
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            document.getElementById('action-btn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—Ç–∞–∫–∞ –∏–ª–∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
                if (player.energy > 10) {
                    player.speed = 6;
                    player.energy -= 1;
                    setTimeout(() => { player.speed = 3; }, 1000);
                }
            });
            
            document.getElementById('special-btn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏
                if (player.stage >= 2 && player.energy > 30) {
                    player.energy -= 30;
                    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–ª–∏ –æ—Å–æ–±—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
                    showNotification("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å!");
                }
            });
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            generateInitialFood();
            generateInitialCreatures();
            
            // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            requestAnimationFrame(gameLoop);
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∏–≥—Ä–æ–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
        }
        
        function startGame() {
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            player = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                speed: 3,
                size: 30,
                energy: 100,
                foodCollected: 0,
                evolutionProgress: 0,
                stage: 0,
                stageNames: ['–û–±–µ–∑—å—è–Ω–∞', '–ì–æ–º–∏–Ω–∏–¥', '–ß–µ–ª–æ–≤–µ–∫ —É–º–µ–ª—ã–π', '–ß–µ–ª–æ–≤–µ–∫ –ø—Ä—è–º–æ—Ö–æ–¥—è—â–∏–π', '–ß–µ–ª–æ–≤–µ–∫ —Ä–∞–∑—É–º–Ω—ã–π'],
                color: '#8b4513'
            };
            
            creatures = [];
            foods = [];
            
            generateInitialFood();
            generateInitialCreatures();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('evolution-screen').classList.add('hidden');
            
            updateStats();
            updateEvolutionBar();
            
            gameActive = true;
        }
        
        function continueGame() {
            document.getElementById('evolution-screen').classList.add('hidden');
            gameActive = true;
        }
        
        function gameOver() {
            gameActive = false;
            document.getElementById('final-stage').textContent = player.stageNames[player.stage];
            document.getElementById('game-over-screen').classList.remove('hidden');
        }
        
        function gameLoop() {
            if (gameActive) {
                update();
                render();
            }
            requestAnimationFrame(gameLoop);
        }
        
        function update() {
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            if (joystick.active) {
                player.x += joystick.x * player.speed;
                player.y += joystick.y * player.speed;
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö canvas
                player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
                player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));
            }
            
            // –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            player.energy -= 0.05;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—ä–µ–¥–µ–Ω–Ω–æ–π –µ–¥—ã
            checkFoodCollision();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å —Å—É—â–µ—Å—Ç–≤–∞–º–∏
            checkCreatureCollisions();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤
            updateCreatures();
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –µ–¥—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (foods.length < 20) {
                generateFood();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π —ç–≤–æ–ª—é—Ü–∏–∏
            checkEvolution();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
            if (player.energy <= 0) {
                gameOver();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateStats();
        }
        
        function render() {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
            drawBackground();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –µ–¥—ã
            drawFood();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤
            drawCreatures();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞
            drawPlayer();
        }
        
        function drawBackground() {
            // –ü—Ä–æ—Å—Ç–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, "#1a2a6c");
            gradient.addColorStop(0.5, "#b21f1f");
            gradient.addColorStop(1, "#fdbb2d");
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –∑–µ–º–ª—é
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
            
            // –†–∏—Å—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤
            ctx.fillStyle = '#5d4037';
            for (let i = 0; i < 5; i++) {
                const x = (i * canvas.width / 5) + (Math.random() * 50);
                ctx.fillRect(x, canvas.height * 0.6, 15, canvas.height * 0.2);
                
                ctx.fillStyle = '#2e7d32';
                ctx.beginPath();
                ctx.arc(x + 7, canvas.height * 0.55, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#5d4037';
            }
        }
        
        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(player.x - 10, player.y - 5, 5, 0, Math.PI * 2);
            ctx.arc(player.x + 10, player.y - 5, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(player.x - 10, player.y - 5, 2, 0, Math.PI * 2);
            ctx.arc(player.x + 10, player.y - 5, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // –†–æ—Ç (–º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏)
            ctx.beginPath();
            if (player.stage < 2) {
                // –û–±–µ–∑—å—è–Ω–∞/–≥–æ–º–∏–Ω–∏–¥
                ctx.arc(player.x, player.y + 5, 7, 0, Math.PI);
            } else {
                // –ë–æ–ª–µ–µ —Ä–∞–∑–≤–∏—Ç—ã–µ —Å—Ç–∞–¥–∏–∏
                ctx.arc(player.x, player.y + 8, 5, 0, Math.PI, true);
            }
            ctx.stroke();
            
            // –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏ —ç–≤–æ–ª—é—Ü–∏–∏
            if (player.stage >= 2) {
                // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–∑–≤–∏—Ç—ã—Ö —Å—Ç–∞–¥–∏–π
                ctx.fillStyle = '#795548';
                ctx.fillRect(player.x + player.size - 5, player.y - 15, 15, 5);
            }
            
            if (player.stage >= 3) {
                // –ë–æ–ª–µ–µ –ø—Ä—è–º–∞—è –æ—Å–∞–Ω–∫–∞
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x - 10, player.y - player.size - 5, 20, 10);
            }
        }
        
        function drawFood() {
            for (const food of foods) {
                ctx.fillStyle = food.color;
                ctx.beginPath();
                ctx.arc(food.x, food.y, food.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawCreatures() {
            for (const creature of creatures) {
                ctx.fillStyle = creature.color;
                ctx.beginPath();
                ctx.arc(creature.x, creature.y, creature.size, 0, Math.PI * 2);
                ctx.fill();
                
                // –ì–ª–∞–∑–∞ –¥–ª—è —Ö–∏—â–Ω–∏–∫–æ–≤
                if (creature.type === 'predator') {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(creature.x - 5, creature.y - 3, 3, 0, Math.PI * 2);
                    ctx.arc(creature.x + 5, creature.y - 3, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'red';
                    ctx.beginPath();
                    ctx.arc(creature.x - 5, creature.y - 3, 1.5, 0, Math.PI * 2);
                    ctx.arc(creature.x + 5, creature.y - 3, 1.5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }
        
        function updateJoystickPosition(x, y) {
            const joystickArea = document.getElementById('joystick-area');
            const joystickElement = document.getElementById('joystick');
            
            const areaRect = joystickArea.getBoundingClientRect();
            const areaCenterX = areaRect.left + areaRect.width / 2;
            const areaCenterY = areaRect.top + areaRect.height / 2;
            
            let dx = x - areaCenterX;
            let dy = y - areaCenterY;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            const distance = Math.min(Math.sqrt(dx * dx + dy * dy), areaRect.width / 2);
            const angle = Math.atan2(dy, dx);
            
            dx = Math.cos(angle) * distance;
            dy = Math.sin(angle) * distance;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–∂–æ–π—Å—Ç–∏–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            joystickElement.style.left = `${areaRect.width / 2 + dx}px`;
            joystickElement.style.top = `${areaRect.height / 2 + dy}px`;
            
            // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
            joystick.x = dx / (areaRect.width / 2);
            joystick.y = dy / (areaRect.height / 2);
        }
        
        function resetJoystick() {
            const joystickElement = document.getElementById('joystick');
            joystickElement.style.left = '50%';
            joystickElement.style.top = '50%';
            
            joystick.x = 0;
            joystick.y = 0;
            joystick.active = false;
            touchId = null;
        }
        
        function generateInitialFood() {
            for (let i = 0; i < 15; i++) {
                generateFood();
            }
        }
        
        function generateFood() {
            const size = 5 + Math.random() * 5;
            const x = Math.random() * canvas.width;
            const y = canvas.height * 0.7 + Math.random() * (canvas.height * 0.3 - size);
            
            // –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –µ–¥—ã —Å —Ä–∞–∑–Ω–æ–π –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç—å—é
            const types = [
                { color: '#8bc34a', energy: 10 },
                { color: '#ffeb3b', energy: 15 },
                { color: '#ff9800', energy: 20 }
            ];
            
            const type = types[Math.floor(Math.random() * types.length)];
            
            foods.push({
                x, y, size,
                color: type.color,
                energy: type.energy
            });
        }
        
        function generateInitialCreatures() {
            // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
            for (let i = 0; i < 5; i++) {
                generateCreature('prey');
            }
            
            for (let i = 0; i < 2; i++) {
                generateCreature('predator');
            }
        }
        
        function generateCreature(type) {
            const size = type === 'predator' ? 25 : 15;
            const x = Math.random() * canvas.width;
            const y = canvas.height * 0.7 + Math.random() * (canvas.height * 0.3 - size);
            
            creatures.push({
                x, y, size, type,
                color: type === 'predator' ? '#f44336' : '#2196f3',
                speed: type === 'predator' ? 1.5 : 1,
                direction: Math.random() * Math.PI * 2,
                directionChangeTime: 0
            });
        }
        
        function updateCreatures() {
            for (const creature of creatures) {
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
                creature.directionChangeTime--;
                if (creature.directionChangeTime <= 0) {
                    creature.direction = Math.random() * Math.PI * 2;
                    creature.directionChangeTime = 50 + Math.random() * 100;
                }
                
                // –•–∏—â–Ω–∏–∫–∏ –ø—Ä–µ—Å–ª–µ–¥—É—é—Ç –∏–≥—Ä–æ–∫–∞
                if (creature.type === 'predator') {
                    const dx = player.x - creature.x;
                    const dy = player.y - creature.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 200) {
                        creature.direction = Math.atan2(dy, dx);
                    }
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤
                creature.x += Math.cos(creature.direction) * creature.speed;
                creature.y += Math.sin(creature.direction) * creature.speed;
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
                if (creature.x < creature.size) creature.x = creature.size;
                if (creature.x > canvas.width - creature.size) creature.x = canvas.width - creature.size;
                if (creature.y < creature.size) creature.y = creature.size;
                if (creature.y > canvas.height - creature.size) creature.y = canvas.height - creature.size;
                
                // –û—Ç—Å–∫–∞–∫–∏–≤–∞–Ω–∏–µ –æ—Ç –≥—Ä–∞–Ω–∏—Ü
                if (creature.x <= creature.size || creature.x >= canvas.width - creature.size) {
                    creature.direction = Math.PI - creature.direction;
                }
                if (creature.y <= creature.size || creature.y >= canvas.height - creature.size) {
                    creature.direction = -creature.direction;
                }
            }
        }
        
        function checkFoodCollision() {
            for (let i = foods.length - 1; i >= 0; i--) {
                const food = foods[i];
                const dx = player.x - food.x;
                const dy = player.y - food.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.size + food.size) {
                    // –ò–≥—Ä–æ–∫ —Å—ä–µ–¥–∞–µ—Ç –µ–¥—É
                    player.energy = Math.min(100, player.energy + food.energy);
                    player.foodCollected++;
                    player.evolutionProgress += food.energy;
                    
                    foods.splice(i, 1);
                    generateFood();
                    
                    updateStats();
                    updateEvolutionBar();
                }
            }
        }
        
        function checkCreatureCollisions() {
            for (const creature of creatures) {
                const dx = player.x - creature.x;
                const dy = player.y - creature.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.size + creature.size) {
                    if (creature.type === 'predator') {
                        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Ö–∏—â–Ω–∏–∫–æ–º –æ—Ç–Ω–∏–º–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é
                        player.energy -= 5;
                        
                        // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ –æ—Ç —Ö–∏—â–Ω–∏–∫–∞
                        const angle = Math.atan2(dy, dx);
                        player.x += Math.cos(angle) * 20;
                        player.y += Math.sin(angle) * 20;
                    } else {
                        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¥–æ–±—ã—á–µ–π –¥–∞–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏
                        player.energy = Math.min(100, player.energy + 5);
                        
                        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ-–¥–æ–±—ã—á—É
                        const index = creatures.indexOf(creature);
                        if (index > -1) {
                            creatures.splice(index, 1);
                            generateCreature('prey');
                        }
                    }
                }
            }
        }
        
        function checkEvolution() {
            const evolutionThresholds = [100, 250, 500, 750, 1000];
            
            if (player.stage < evolutionThresholds.length && 
                player.evolutionProgress >= evolutionThresholds[player.stage]) {
                evolve();
            }
        }
        
        function evolve() {
            gameActive = false;
            player.stage++;
            
            // –ò–∑–º–µ–Ω—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏
            player.size = 30 + player.stage * 5;
            player.speed = 3 + player.stage * 0.5;
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏
            const colors = ['#8b4513', '#a0522d', '#cd853f', '#d2b48c', '#f5deb3'];
            player.color = colors[Math.min(player.stage, colors.length - 1)];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏
            document.getElementById('evolution-stage').textContent = player.stageNames[player.stage];
            document.getElementById('evolution-screen').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–¥–∏–∏
            document.getElementById('stage-indicator').textContent = player.stageNames[player.stage];
            
            showNotification(`–í—ã —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª–∏ –≤ ${player.stageNames[player.stage]}!`);
        }
        
        function updateStats() {
            document.getElementById('energy-value').textContent = Math.floor(player.energy);
            document.getElementById('food-count').textContent = player.foodCollected;
        }
        
        function updateEvolutionBar() {
            const evolutionThresholds = [100, 250, 500, 750, 1000];
            const currentThreshold = player.stage < evolutionThresholds.length ? 
                evolutionThresholds[player.stage] : evolutionThresholds[evolutionThresholds.length - 1];
            const prevThreshold = player.stage > 0 ? evolutionThresholds[player.stage - 1] : 0;
            
            const progress = player.evolutionProgress - prevThreshold;
            const maxProgress = currentThreshold - prevThreshold;
            
            const percentage = (progress / maxProgress) * 100;
            document.getElementById('evolution-bar').style.width = `${percentage}%`;
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'evolution-notification';
            notification.textContent = message;
            
            document.getElementById('game-container').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = init;
    </script>
</body>
</html>
